<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive AD-AS Model Dashboard</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOVEMVIhbGKZC0svKNUROgsE7FVU2TwuUmdlNP9GGUo2CRI3BlgN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Source+Serif+4:opsz,wght@8..60,400;8..60,600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; }
        .katex { font-size: 1.1em; }
        .section-title { font-family: 'Source Serif 4', serif; font-weight: 600; }
        .tooltip {
            position: absolute; text-align: center; padding: 8px 12px;
            font: 12px 'Inter', sans-serif; background: rgba(15, 23, 42, 0.9);
            color: white; border: 0px; border-radius: 8px; pointer-events: none;
            opacity: 0; transition: opacity 0.2s; backdrop-filter: blur(4px);
        }
        .shock-btn { transition: all 0.2s ease-in-out; }
        .shock-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .story-highlight {
            background-color: rgba(254, 249, 231, 1); /* yellow-50 */
            border-left: 3px solid rgba(245, 158, 11, 1); /* amber-500 */
            padding: 0.75rem; border-radius: 0.25rem;
        }
        .axis-label { font-size: 14px; }
    </style>
</head>
<body class="antialiased text-slate-800">

    <div class="max-w-screen-2xl mx-auto p-4 sm:p-6 lg:p-8">
        <div class="text-center mb-10">
            <h1 class="text-4xl font-bold text-slate-900 tracking-tight sm:text-5xl section-title">The Aggregate Demand-Supply Model</h1>
            <p class="mt-3 text-lg text-slate-600 max-w-4xl mx-auto">An interactive dashboard for analyzing business cycles, economic shocks, and the dynamic adjustment of output and prices.</p>
        </div>

        <div class="grid grid-cols-1 xl:grid-cols-12 gap-6">
            
            <!-- Left Column: Controls & Shocks -->
            <div class="xl:col-span-3 space-y-6">
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
                    <h2 class="text-2xl text-slate-800 border-b pb-3 mb-4 section-title">Model Parameters</h2>
                    <div id="controls-container" class="space-y-5"></div>
                </div>
                 <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
                    <h2 class="text-2xl text-slate-800 border-b pb-3 mb-4 section-title">Economic Shocks</h2>
                    <div id="shocks-container" class="grid grid-cols-2 gap-3 text-sm"></div>
                </div>
            </div>

            <!-- Middle Column: Visualizations -->
            <div class="xl:col-span-6 bg-white p-4 sm:p-6 rounded-2xl shadow-xl border border-slate-200 space-y-4">
                <div>
                    <h3 class="text-xl font-semibold text-slate-700 text-center mb-2">AD-AS Diagram & Dynamic Path</h3>
                    <div id="adas-chart-container"></div>
                </div>
                <div class="border-t pt-4 grid grid-cols-2 gap-4">
                     <div>
                        <h3 class="text-lg font-semibold text-slate-700 text-center mb-2">Output Path</h3>
                        <div id="y-path-chart-container"></div>
                     </div>
                     <div>
                        <h3 class="text-lg font-semibold text-slate-700 text-center mb-2">Price Path</h3>
                        <div id="p-path-chart-container"></div>
                     </div>
                </div>
            </div>

            <!-- Right Column: Analysis -->
            <div class="xl:col-span-3 bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
                <h2 class="text-2xl text-slate-800 border-b pb-3 mb-4 section-title">Analysis</h2>
                <div id="story-container" class="text-sm text-slate-700 leading-relaxed mb-6"></div>
                <div id="equations-container" class="space-y-4 text-sm"></div>
            </div>
        </div>
    </div>

    <script type="module">
        const DURATION = 750;
        const EASE = d3.easeCubicOut;
        const COLORS = {
            ad: "#2563eb", lras: "#16a34a", path: "#dc2626",
            y_path: "#2563eb", p_path: "#991b1b", equilibrium: "#16a34a"
        };

        let state = {};

        const params = {
            a: { min: 80, max: 150, value: 120, step: 5, label: "AD Intercept", symbol: "a" },
            b: { min: 1, max: 30, value: 10, step: 1, label: "AD Slope Param.", symbol: "b" },
            Y_bar: { min: 80, max: 120, value: 100, step: 1, label: "Potential Output", symbol: "\\bar{Y}" },
            c: { min: 0.5, max: 20, value: 5, step: 0.5, label: "Price Inertia", symbol: "c" },
            P0: { min: 0.5, max: 4.0, value: 1.0, step: 0.05, label: "Initial Price", symbol: "P₀" },
            T: { min: 5, max: 50, value: 20, step: 1, label: "Time Horizon", symbol: "T" }
        };

        const shocks = {
            'ad_pos': { label: "Demand Boom", param: 'a', change: 20 },
            'ad_neg': { label: "Demand Bust", param: 'a', change: -20 },
            'price_shock': { label: "Price Shock", param: 'P0', change: 1.0 }
        };

        // --- D3 SETUP ---
        const adasMargin = { top: 20, right: 20, bottom: 40, left: 50 };
        const adasContainer = document.getElementById('adas-chart-container');
        let adasWidth = adasContainer.clientWidth - adasMargin.left - adasMargin.right;
        let adasHeight = adasWidth * 0.6;
        const adasSvg = d3.select("#adas-chart-container").append("svg")
            .attr("viewBox", `0 0 ${adasWidth + adasMargin.left + adasMargin.right} ${adasHeight + adasMargin.top + adasMargin.bottom}`)
            .append("g").attr("transform", `translate(${adasMargin.left},${adasMargin.top})`);
        
        const pathMargin = { top: 10, right: 10, bottom: 30, left: 40 };
        const yPathContainer = document.getElementById('y-path-chart-container');
        const pPathContainer = document.getElementById('p-path-chart-container');
        let pathWidth = yPathContainer.clientWidth - pathMargin.left - pathMargin.right;
        let pathHeight = pathWidth * 0.7;
        const yPathSvg = d3.select("#y-path-chart-container").append("svg")
             .attr("viewBox", `0 0 ${pathWidth + pathMargin.left + pathMargin.right} ${pathHeight + pathMargin.top + pathMargin.bottom}`)
             .append("g").attr("transform", `translate(${pathMargin.left},${pathMargin.top})`);
        const pPathSvg = d3.select("#p-path-chart-container").append("svg")
             .attr("viewBox", `0 0 ${pathWidth + pathMargin.left + pathMargin.right} ${pathHeight + pathMargin.top + pathMargin.bottom}`)
             .append("g").attr("transform", `translate(${pathMargin.left},${pathMargin.top})`);
        
        // --- CALCULATIONS ---
        function calculateState() {
            const currentState = {};
            Object.keys(params).forEach(key => currentState[key] = +d3.select(`#${key}`).property("value"));
            
            const { a, b, Y_bar, c, P0, T } = currentState;
            const lambda_adjust = 1.0 / c;
            
            const Y = [0];
            const P = [0];
            P[0] = P0;
            Y[0] = a - b * P[0];

            for (let t = 1; t < T; t++) {
                P[t] = P[t-1] + lambda_adjust * (Y[t-1] - Y_bar);
                P[t] = Math.max(P[t], 1e-6);
                Y[t] = a - b * P[t];
            }
            
            currentState.time_series = d3.range(T).map(i => ({t: i, y: Y[i], p: P[i]}));
            currentState.P_star = (a - Y_bar) / b;
            return currentState;
        }

        // --- RENDER FUNCTIONS ---
        function render() {
            state = calculateState();
            
            Object.entries(params).forEach(([key, p]) => {
                const val = d3.select(`#${key}`).property("value");
                d3.select(`#${key}-value`).text(parseFloat(val).toFixed(p.step < 1 ? 2 : 0));
            });
            
            renderAdAsChart();
            renderPathCharts();
            renderAnalysis();
        }

        function renderAdAsChart() {
            const t = d3.transition().duration(DURATION).ease(EASE);
            const { time_series, Y_bar, P_star, a, b } = state;
            
            const xDomain = d3.extent([...time_series.map(d => d.y), Y_bar]);
            const yDomain = d3.extent([...time_series.map(d => d.p), P_star]);
            
            const xScale = d3.scaleLinear().domain([xDomain[0] * 0.9, xDomain[1] * 1.1]).range([0, adasWidth]);
            const yScale = d3.scaleLinear().domain([yDomain[0] * 0.9, yDomain[1] * 1.1]).range([adasHeight, 0]);

            adasSvg.select(".x-axis").transition(t).call(d3.axisBottom(xScale));
            adasSvg.select(".y-axis").transition(t).call(d3.axisLeft(yScale));

            const ad_line_data = [{y: a - b * yScale.domain()[0], p: yScale.domain()[0]}, {y: a - b * yScale.domain()[1], p: yScale.domain()[1]}];
            adasSvg.select(".ad-curve").datum(ad_line_data).transition(t).attr("d", d3.line().x(d => xScale(d.y)).y(d => yScale(d.p)));
            adasSvg.select(".lras-curve").transition(t).attr("x1", xScale(Y_bar)).attr("x2", xScale(Y_bar));

            const path = adasSvg.select(".dynamic-path").datum(time_series);
            path.transition(t).attr("d", d3.line().x(d => xScale(d.y)).y(d => yScale(d.p)));
            const totalLength = path.node().getTotalLength();
            path.attr("stroke-dasharray", totalLength + " " + totalLength)
                .attr("stroke-dashoffset", totalLength)
                .transition().duration(DURATION * 1.5).ease(d3.easeLinear)
                .attr("stroke-dashoffset", 0);
            
            adasSvg.select(".start-point").transition(t).attr("cx", xScale(time_series[0].y)).attr("cy", yScale(time_series[0].p));
            adasSvg.select(".equilibrium-point").transition(t).attr("cx", xScale(Y_bar)).attr("cy", yScale(P_star));
        }

        function renderPathCharts() {
            const t = d3.transition().duration(DURATION).ease(EASE);
            const { time_series, Y_bar, P_star, T } = state;

            // Y Path
            const y_xScale = d3.scaleLinear().domain([0, T-1]).range([0, pathWidth]);
            const y_yScale = d3.scaleLinear().domain(d3.extent(time_series, d => d.y)).range([pathHeight, 0]).nice();
            yPathSvg.select(".x-axis").transition(t).call(d3.axisBottom(y_xScale).ticks(5));
            yPathSvg.select(".y-axis").transition(t).call(d3.axisLeft(y_yScale).ticks(5));
            yPathSvg.select(".y-path").datum(time_series).transition(t).attr("d", d3.line().x(d => y_xScale(d.t)).y(d => y_yScale(d.y)));
            yPathSvg.select(".y-bar-line").transition(t).attr("y1", y_yScale(Y_bar)).attr("y2", y_yScale(Y_bar));
            
            // P Path
            const p_xScale = d3.scaleLinear().domain([0, T-1]).range([0, pathWidth]);
            const p_yScale = d3.scaleLinear().domain(d3.extent(time_series, d => d.p)).range([pathHeight, 0]).nice();
            pPathSvg.select(".x-axis").transition(t).call(d3.axisBottom(p_xScale).ticks(5));
            pPathSvg.select(".y-axis").transition(t).call(d3.axisLeft(p_yScale).ticks(5));
            pPathSvg.select(".p-path").datum(time_series).transition(t).attr("d", d3.line().x(d => p_xScale(d.t)).y(d => p_yScale(d.p)));
            pPathSvg.select(".p-star-line").transition(t).attr("y1", p_yScale(P_star)).attr("y2", p_yScale(P_star));
        }

        function renderAnalysis() {
            const { Y_bar, P_star, time_series } = state;
            const initial_y = time_series[0].y;
            const output_gap = initial_y - Y_bar;
            
            let story = "";
            if (Math.abs(output_gap) < 0.1) {
                story = `The economy starts at or very near its long-run equilibrium (Y ≈ Ȳ). Prices and output are stable.`;
            } else if (output_gap > 0) {
                story = `The economy begins with an <b>inflationary gap</b> of <b>${output_gap.toFixed(1)}</b>. Output is above its sustainable potential.`;
                story += `<br><br><div class="story-highlight">This high demand puts upward pressure on prices. As prices rise, the real quantity of goods and services demanded falls (a movement along the AD curve), causing output to contract back towards potential.</div>`;
            } else {
                story = `The economy begins with a <b>recessionary gap</b> of <b>${output_gap.toFixed(1)}</b>. Output is below its sustainable potential.`;
                story += `<br><br><div class="story-highlight">This slack in the economy puts downward pressure on prices. As prices fall, the real quantity of goods and services demanded rises, causing output to expand back towards potential.</div>`;
            }
            d3.select("#story-container").html(story);

            const ad_latex = `Y = a - b P`;
            const as_latex = `P_t = P_{t-1} + \\frac{1}{c}(Y_{t-1} - \\bar{Y})`;
            const equil_latex = `P^* = \\frac{a - \\bar{Y}}{b} = ${P_star.toFixed(2)}`;

            d3.select("#equations-container").html(`
                <div class="p-3 bg-slate-50 rounded-md"><div id="ad-eq"></div></div>
                <div class="p-3 bg-slate-50 rounded-md"><div id="as-eq"></div></div>
                <div class="p-3 bg-slate-50 rounded-md"><div id="equil-eq"></div></div>
            `);
            katex.render(ad_latex, document.getElementById('ad-eq'), { throwOnError: false });
            katex.render(as_latex, document.getElementById('as-eq'), { throwOnError: false });
            katex.render(equil_latex, document.getElementById('equil-eq'), { throwOnError: false });
        }
        
        // --- INITIALIZATION ---
        function init() {
            // Controls & Shocks
            const controlsContainer = d3.select("#controls-container");
            Object.entries(params).forEach(([key, p]) => {
                controlsContainer.html(controlsContainer.html() + `
                    <div>
                        <label for="${key}" class="flex justify-between text-sm font-medium text-slate-600">
                            <span>${p.label} ($${p.symbol}$)</span><span id="${key}-value" class="font-semibold text-slate-800"></span>
                        </label>
                        <input type="range" id="${key}" min="${p.min}" max="${p.max}" value="${p.value}" step="${p.step}" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                    </div>`);
            });
            const shocksContainer = d3.select("#shocks-container");
            Object.entries(shocks).forEach(([key, s]) => {
                shocksContainer.html(shocksContainer.html() + `<button id="${key}" class="shock-btn w-full bg-slate-100 text-slate-700 font-semibold py-2 px-2 rounded-lg shadow-sm hover:bg-slate-200">${s.label}</button>`);
            });
            
            // AD-AS Chart Elements
            adasSvg.append("g").attr("class", "x-axis").attr("transform", `translate(0,${adasHeight})`);
            adasSvg.append("g").attr("class", "y-axis");
            adasSvg.append("line").attr("class", "lras-curve").attr("y1", 0).attr("y2", adasHeight).attr("stroke", COLORS.lras).attr("stroke-width", 3);
            adasSvg.append("path").attr("class", "ad-curve").attr("fill", "none").attr("stroke", COLORS.ad).attr("stroke-width", 3);
            adasSvg.append("path").attr("class", "dynamic-path").attr("fill", "none").attr("stroke", COLORS.path).attr("stroke-width", 2.5);
            adasSvg.append("circle").attr("class", "start-point").attr("r", 6).attr("fill", COLORS.path);
            adasSvg.append("circle").attr("class", "equilibrium-point").attr("r", 6).attr("fill", COLORS.equilibrium).attr("stroke", "white").attr("stroke-width", 2);
            adasSvg.append("text").attr("class", "axis-label").attr("x", adasWidth / 2).attr("y", adasHeight + 35).attr("text-anchor", "middle").text("Output (Y)");
            adasSvg.append("text").attr("class", "axis-label").attr("transform", "rotate(-90)").attr("x", -adasHeight / 2).attr("y", -40).attr("text-anchor", "middle").text("Price Level (P)");

            // Path Chart Elements
            [yPathSvg, pPathSvg].forEach((svg, i) => {
                const color = i === 0 ? COLORS.y_path : COLORS.p_path;
                const lineClass = i === 0 ? "y-bar-line" : "p-star-line";
                svg.append("g").attr("class", "x-axis").attr("transform", `translate(0,${pathHeight})`);
                svg.append("g").attr("class", "y-axis");
                svg.append("path").attr("class", i === 0 ? "y-path" : "p-path").attr("fill", "none").attr("stroke", color).attr("stroke-width", 2.5);
                svg.append("line").attr("class", lineClass).attr("x1", 0).attr("x2", pathWidth).attr("stroke", COLORS.equilibrium).attr("stroke-width", 1.5).attr("stroke-dasharray", "4 4");
            });

            // Event Listeners
            Object.keys(params).forEach(key => d3.select(`#${key}`).on("input", render));
            Object.entries(shocks).forEach(([key, s]) => {
                d3.select(`#${key}`).on("click", () => {
                    d3.select(`#${s.param}`).property("value", parseFloat(d3.select(`#${s.param}`).property("value")) + s.change);
                    render();
                });
            });
            
            render();
        }

        init();
    </script>
</body>
</html>
