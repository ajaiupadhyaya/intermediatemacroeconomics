<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic IS-AS-MP Shock Dashboard</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOVEMVIhbGKZC0svKNUROgsE7FVU2TwuUmdlNP9GGUo2CRI3BlgN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Source+Serif+4:opsz,wght@8..60,400;8..60,600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; }
        .katex { font-size: 1.0em; }
        .section-title { font-family: 'Source Serif 4', serif; font-weight: 600; }
        .axis-label { font-size: 12px; }
        .story-highlight { background-color: #f0f9ff; border-left: 3px solid #0ea5e9; padding: 0.75rem; border-radius: 0.25rem; }
    </style>
</head>
<body class="antialiased text-slate-800">

    <div class="max-w-screen-2xl mx-auto p-4 sm:p-6 lg:p-8">
        <div class="text-center mb-10">
            <h1 class="text-4xl font-bold text-slate-900 tracking-tight sm:text-5xl section-title">Dynamic Macroeconomic Shocks</h1>
            <p class="mt-3 text-lg text-slate-600 max-w-4xl mx-auto">An interactive simulation of the IS-AS-MP model, showing how the economy responds to demand, supply, and policy shocks over time.</p>
        </div>

        <div class="grid grid-cols-1 xl:grid-cols-12 gap-6">
            
            <div class="xl:col-span-3 space-y-6">
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
                    <h2 class="text-2xl text-slate-800 border-b pb-3 mb-4 section-title">Model Parameters</h2>
                    <div id="controls-container" class="space-y-4"></div>
                </div>
                 <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
                    <h2 class="text-2xl text-slate-800 border-b pb-3 mb-4 section-title">Shock Scenario</h2>
                    <div id="shocks-container" class="space-y-4"></div>
                </div>
            </div>

            <div class="xl:col-span-6 bg-white p-4 sm:p-6 rounded-2xl shadow-xl border border-slate-200 space-y-4">
                <h3 class="text-xl font-semibold text-slate-700 text-center">Dynamic Response Paths</h3>
                 <div id="charts-grid" class="grid grid-cols-2 gap-4">
                    <!-- Charts will be injected here -->
                </div>
            </div>

            <div class="xl:col-span-3 bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
                <div id="analysis-content">
                    <h2 class="text-2xl text-slate-800 border-b pb-3 mb-4 section-title">Analysis</h2>
                    <div id="story-container" class="text-sm text-slate-700 leading-relaxed mb-6"></div>
                    <div id="equations-container" class="space-y-2 text-sm"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        let state = {};
        const DURATION = 750;
        const EASE = d3.easeCubicOut;
        const COLORS = { Y: "#16a34a", pi: "#dc2777", r: "#f59e0b", path: "#4f46e5" };
        const params = {
            pi_e: { min: 0, max: 5, value: 2.0, step: 0.1, label: "Expected Inflation", symbol: "πᵉ" },
            pi_star: { min: 0, max: 5, value: 2.0, step: 0.1, label: "Inflation Target", symbol: "π*" },
            Y_bar: { min: 80, max: 120, value: 100, step: 1, label: "Potential Output", symbol: "Ȳ" },
            r_bar: { min: 0, max: 5, value: 2.0, step: 0.1, label: "Natural Interest Rate", symbol: "r̄" },
            phi_pi: { min: 0.1, max: 4.0, value: 1.5, step: 0.1, label: "Taylor Rule Coeff.", symbol: "φ_π" },
            lamb_as: { min: 0.05, max: 1.0, value: 0.3, step: 0.05, label: "AS Slope", symbol: "λ" },
            alpha_is: { min: 1, max: 10, value: 5.0, step: 0.5, label: "IS Sensitivity", symbol: "α" },
            T: { min: 10, max: 60, value: 25, step: 1, label: "Periods", symbol: "T" }
        };

        const chartInfos = [
            { id: 'y-chart', title: 'Output (Y)', y_vars: ['Y'], eq: 'Y_bar' },
            { id: 'pi-chart', title: 'Inflation (π)', y_vars: ['pi'], eq: 'pi_star' },
            { id: 'r-chart', title: 'Real Interest Rate (r)', y_vars: ['r'], eq: 'r_bar' },
            { id: 'path-chart', title: 'Output-Inflation Path', x_var: 'Y', y_var: 'pi' }
        ];
        const charts = {};

        function calculateState(p) {
            const s = {};
            Object.keys(params).forEach(key => s[key] = +p[key].value);
            const shock_type = d3.select("#shock-type").property("value");
            const shock_mag = +d3.select("#shock-mag").property("value");

            const { pi_e, pi_star, Y_bar, r_bar, phi_pi, lamb_as, alpha_is, T } = s;
            const pi = [0], Y = [0], r = [0];
            const eps_AD = [0], eps_AS = [0];
            
            pi[0] = pi_e;
            if (shock_type === 'Expectations') pi[0] += shock_mag;
            r[0] = r_bar + phi_pi * (pi[0] - pi_star);
            Y[0] = Y_bar - alpha_is * (r[0] - r_bar);
            
            const shock_period = 2;
            if (shock_type === "Negative Demand") eps_AD[shock_period] = -shock_mag;
            if (shock_type === "Positive Supply") eps_AS[shock_period] = -shock_mag;
            if (shock_type === "Negative Supply") eps_AS[shock_period] = shock_mag;

            for (let t = 1; t < T; t++) {
                r[t] = r_bar + phi_pi * (pi[t-1] - pi_star);
                Y[t] = Y_bar - alpha_is * (r[t] - r_bar) + (eps_AD[t] || 0);
                pi[t] = pi_e + lamb_as * (Y[t] - Y_bar) + (eps_AS[t] || 0);
            }
            
            s.time_series = d3.range(T).map(i => ({ t: i, Y: Y[i], pi: pi[i], r: r[i] }));
            return s;
        }
        
        function render() {
            const currentParams = {};
            Object.keys(params).forEach(key => currentParams[key] = {value: d3.select(`#${key}`).property("value")});
            state = calculateState(currentParams);
            
            Object.entries(params).forEach(([key, p]) => {
                const val = state[key];
                d3.select(`#${key}-value`).text(parseFloat(val).toFixed(p.step < 1 ? 1 : 0));
            });
            
            renderCharts(state);
            renderAnalysis(state);
        }

        function renderCharts(s) {
            const t = d3.transition().duration(DURATION).ease(EASE);
            const { time_series, T } = s;

            chartInfos.forEach(info => {
                const chart = charts[info.id];
                if (info.id === 'path-chart') {
                    const x_extent = d3.extent(time_series, d => d.Y);
                    const y_extent = d3.extent(time_series, d => d.pi);
                    const xScale = d3.scaleLinear().domain(x_extent).range([0, chart.width]).nice();
                    const yScale = d3.scaleLinear().domain(y_extent).range([chart.height, 0]).nice();
                    
                    chart.svg.select(".x-axis").transition(t).call(d3.axisBottom(xScale).ticks(5));
                    chart.svg.select(".y-axis").transition(t).call(d3.axisLeft(yScale).ticks(4));
                    chart.svg.select(".path").datum(time_series).transition(t).attr("d", d3.line().x(d => xScale(d.Y)).y(d => yScale(d.pi)));
                    chart.svg.select(".start-point").transition(t).attr("cx", xScale(time_series[0].Y)).attr("cy", yScale(time_series[0].pi));
                    chart.svg.select(".eq-point").transition(t).attr("cx", xScale(s.Y_bar)).attr("cy", yScale(s.pi_star));

                } else {
                    const y_data = info.y_vars.flatMap(v => time_series.map(d => d[v]));
                    const y_extent = d3.extent(y_data);
                    
                    const xScale = d3.scaleLinear().domain([0, T]).range([0, chart.width]);
                    const yScale = d3.scaleLinear().domain(y_extent).range([chart.height, 0]).nice();

                    chart.svg.select(".x-axis").transition(t).call(d3.axisBottom(xScale).ticks(5));
                    chart.svg.select(".y-axis").transition(t).call(d3.axisLeft(yScale).ticks(4));
                    chart.svg.select(".eq-line").transition(t).attr("y1", yScale(s[info.eq])).attr("y2", yScale(s[info.eq]));
                    
                    info.y_vars.forEach(v => {
                        chart.svg.select(`.${v}-path`).datum(time_series)
                            .transition(t)
                            .attr("d", d3.line().x(d => xScale(d.t)).y(d => yScale(d[v])));
                    });
                }
            });
        }

        function renderAnalysis(s) { /* ... */ }
        function init() { /* ... */ }
        init();
    </script>
</body>
</html>
