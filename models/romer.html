<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Romer Model of Endogenous Growth Dashboard</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOVEMVIhbGKZC0svKNUROgsE7FVU2TwuUmdlNP9GGUo2CRI3BlgN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Source+Serif+4:opsz,wght@8..60,400;8..60,600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; }
        .section-title { font-family: 'Source Serif 4', serif; font-weight: 600; }
        .story-highlight { background-color: #f0f9ff; border-left: 3px solid #0ea5e9; padding: 0.75rem; border-radius: 0.25rem; }
    </style>
</head>
<body class="antialiased text-slate-800">

    <div class="max-w-screen-2xl mx-auto p-4 sm:p-6 lg:p-8">
        <div class="text-center mb-10">
            <h1 class="text-4xl font-bold text-slate-900 tracking-tight sm:text-5xl section-title">The Romer Model of Endogenous Growth</h1>
            <p class="mt-3 text-lg text-slate-600 max-w-4xl mx-auto">An interactive simulation showing how investment in ideas and R&D can generate sustained long-run economic growth.</p>
        </div>

        <div class="grid grid-cols-1 xl:grid-cols-12 gap-6">
            
            <div class="xl:col-span-3 space-y-6">
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
                    <h2 class="text-2xl text-slate-800 border-b pb-3 mb-4 section-title">Model Parameters</h2>
                    <div id="controls-container" class="space-y-5"></div>
                </div>
            </div>

            <div class="xl:col-span-6 bg-white p-4 sm:p-6 rounded-2xl shadow-xl border border-slate-200 space-y-4">
                <h3 class="text-xl font-semibold text-slate-700 text-center">Balanced Growth Path (Log Scale)</h3>
                <div id="charts-grid" class="grid grid-cols-2 gap-4">
                    <!-- Charts will be injected here -->
                </div>
            </div>

            <div class="xl:col-span-3 bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
                <div id="analysis-content">
                    <h2 class="text-2xl text-slate-800 border-b pb-3 mb-4 section-title">Analysis</h2>
                    <div id="story-container" class="text-sm text-slate-700 leading-relaxed mb-6"></div>
                    <div id="equations-container" class="space-y-4 text-sm"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        let state = {};
        const DURATION = 750;
        const EASE = d3.easeCubicOut;
        const COLORS = { A: "#db2777", L: "#16a34a", Y: "#1e293b", Y_per_L: "#4f46e5" };
        const params = {
            z_delta_A: { min: 0.0, max: 0.005, value: 0.0005, step: 0.0001, label: "R&D Productivity", symbol: "δ_A" },
            L0: { min: 10, max: 1000, value: 100, step: 10, label: "Initial Labor", symbol: "L₀" },
            n: { min: 0.0, max: 0.05, value: 0.01, step: 0.002, label: "Labor Growth", symbol: "n" },
            omega: { min: 0.01, max: 0.5, value: 0.1, step: 0.01, label: "R&D Share", symbol: "ω" },
            A0: { min: 0.1, max: 10.0, value: 1.0, step: 0.1, label: "Initial Technology", symbol: "A₀" },
            T: { min: 10, max: 200, value: 100, step: 5, label: "Time Horizon", symbol: "T" }
        };

        const chartInfos = [
            { id: 'al-chart', title: 'Technology & Labor', vars: ['A', 'L'] },
            { id: 'y-chart', title: 'Output', vars: ['Y', 'Y_per_L'] }
        ];
        const charts = {};

        function calculateState(p) {
            const s = {};
            Object.keys(params).forEach(key => s[key] = +p[key].value);
            const { z_delta_A, L0, n, omega, A0, T } = s;
            
            const A = [A0], L = [L0];
            for (let t = 0; t < T; t++) {
                const L_A = omega * L[t];
                const g_A = z_delta_A * L_A;
                A.push(A[t] * (1 + g_A));
                L.push(L[t] * (1 + n));
            }
            
            s.time_series = d3.range(T + 1).map(t => {
                const L_Y = (1 - omega) * L[t];
                const Y = A[t] * L_Y;
                return { t, A: A[t], L: L[t], Y, Y_per_L: Y / L[t] };
            });
            s.final_gA = (A[T] / A[T-1] - 1);
            return s;
        }
        
        function render() {
            const currentParams = {};
            Object.keys(params).forEach(key => currentParams[key] = {value: d3.select(`#${key}`).property("value")});
            state = calculateState(currentParams);
            
            Object.entries(params).forEach(keyVal => { /* update readouts */ });
            
            renderCharts(state);
            renderAnalysis(state);
        }

        function renderCharts(s) {
            const t = d3.transition().duration(DURATION).ease(EASE);
            const { time_series, T } = s;

            chartInfos.forEach(info => {
                const chart = charts[info.id];
                const xScale = d3.scaleLinear().domain([0, T]).range([0, chart.width]);
                const y_data = info.vars.flatMap(v => time_series.map(d => d[v]));
                const yScale = d3.scaleLog().domain([d3.min(y_data), d3.max(y_data)]).range([chart.height, 0]).nice();

                chart.svg.select(".x-axis").transition(t).call(d3.axisBottom(xScale).ticks(5));
                chart.svg.select(".y-axis").transition(t).call(d3.axisLeft(yScale).ticks(4, d3.format(".1s")));

                info.vars.forEach(v => {
                    chart.svg.select(`.${v}-path`).datum(time_series)
                        .transition(t)
                        .attr("d", d3.line().x(d => xScale(d.t)).y(d => yScale(d[v])));
                });
            });
        }

        function renderAnalysis(s) { /* ... */ }
        function init() { /* ... */ }
        init();
    </script>
</body>
</html>
